الدور/Role:
أنت مطوّر Full-Stack أقدّم لك مستودعًا جاهزًا باسم Allajnah (نظام شكاوى إلكتروني). المطلوب هو إضافة بوابة اشتراك سنوي تُغلق التطبيق حتى يقوم المستخدم بالدفع/التفعيل، مع صفحة دفع تدعم المحافظ الإلكترونية/التحويل البنكي في اليمن (قابلة للتخصيص)، ثم تفعيل تلقائي للصلاحيات بعد موافقة المشرف. إضافةً إلى ذلك، نفّذ تحسينات كبيرة في البنية، الأمان، الاختبارات، والتجربة البصرية دون كسر الميزات الحالية.

ملاحظة تقنية: backend لدينا مكتوب بـPython (غالباً FastAPI/Flask) وواجهة Frontend (JS). إن كان الإطار مختلفًا داخل المستودع، تكيّف مع الموجود مع الحفاظ على نفس النتائج والمتطلبات.

1) متطلبات العمل (Business & UX)

الصفحة الأولى عند فتح التطبيق (Subscription Gate):

عند دخول أي مستخدم (موبايل/كمبيوتر) يُوجَّه مباشرة إلى صفحة اشتراك سنوي قبل أي صفحة أخرى.

الصفحة توضّح أن الخدمة باشتراك سنوي وأن عليه الدفع لتفعيل الحساب.

زر واضح: "اشترك الآن" → ينقله إلى صفحة الدفع.

لا يسمح بالوصول لباقي ميزات النظام قبل تفعيل الاشتراك (باستثناء صفحات عامّة مثل “الشروط/سياسة الخصوصية/تواصل معنا” إن وجدت).

صفحة الدفع (Payment Page):

تعرض طرق الدفع القابلة للتخصيص من لوحة الإدارة:

محافظ إلكترونية يمنية أو تحويل بنكي/هاتف إلى رقم معيّن مع اسم صاحب الحساب

لكل طريقة دفع: الاسم التجاري، رقم/حساب التحويل، اسم المستلم، QR Image اختياري، ملاحظات.

عرض قيمة الاشتراك السنوي بالريال اليمني YER (قابلة للتعديل من الإعدادات).

زر "أتممت التحويل/الدفع" ينقل لفرم إثبات الدفع.

إثبات الدفع (Payment Proof Submission):

نموذج يجمع: طريقة الدفع المختارة، اسم المُرسل، رقم هاتفه، مرجع التحويل/آخر 4 أرقام من العملية إن وُجد، المبلغ، تاريخ/وقت التحويل، رفع صورة إيصال (لقطة شاشة).

إنشاء سجل Payment بالحالة pending وعرض شاشة "بانتظار المراجعة" للمستخدم.

مراجعة الدفع (Admin Review):

في لوحة المشرف: جدول مدفوعات بانتظار المراجعة مع فلترة/فرز، ومعاينة الإيصال، وأزرار “اعتماد” أو “رفض” مع ملاحظة.

عند الاعتماد: إنشاء/تحديث Subscription للمستخدم لمدة سنة كاملة (365 يومًا) من تاريخ الاعتماد أو من نهاية اشتراكه الحالي، وتعيين حالة الاشتراك active.

عند الرفض: إرسال إشعار داخل التطبيق للمستخدم مع سبب الرفض وإتاحة إعادة الرفع.

تفعيل الصلاحيات (Post-Activation):

بعد الاعتماد، يفتح التطبيق تلقائيًا بوصف مستخدم عميل ويُسمح له بكل صلاحيات العميل الموجودة في النظام (حسب RBAC أدناه).