# تصميم قاعدة البيانات والهيكل التقني لتطبيق الشكاوى الإلكتروني

بناءً على المتطلبات المحددة، سيتم تصميم قاعدة بيانات علائقية باستخدام **PostgreSQL** لضمان المرونة، قابلية التوسع، ودعم الميزات المتقدمة المطلوبة. يهدف التصميم إلى استيعاب جميع البيانات المتعلقة بالمستخدمين، الشكاوى، حالاتها، التصنيفات، والإشعارات، بالإضافة إلى دعم التقارير ولوحات المتابعة.

## 1. الكيانات والجداول الرئيسية

سيتم تقسيم قاعدة البيانات إلى عدة جداول رئيسية لتمثيل الكيانات المختلفة في النظام:

### أ. جدول `Users` (المستخدمون)
يحتوي هذا الجدول على معلومات جميع المستخدمين الذين يمكنهم الوصول إلى النظام، بما في ذلك التجار وأعضاء اللجان.

| الحقل            | نوع البيانات      | الوصف                                   | ملاحظات                                     |
| :--------------- | :---------------- | :-------------------------------------- | :------------------------------------------- |
| `user_id`        | `UUID` / `BIGINT` | معرف فريد للمستخدم (مفتاح أساسي)        |                                              |
| `username`       | `VARCHAR(255)`    | اسم المستخدم الفريد                     | مطلوب، فريد                                 |
| `email`          | `VARCHAR(255)`    | البريد الإلكتروني للمستخدم              | مطلوب، فريد                                 |
| `password_hash`  | `VARCHAR(255)`    | تجزئة كلمة المرور                       | مطلوب                                       |
| `full_name`      | `VARCHAR(255)`    | الاسم الكامل للمستخدم                   | مطلوب                                       |
| `phone_number`   | `VARCHAR(50)`     | رقم هاتف المستخدم                       |                                              |
| `address`        | `TEXT`            | عنوان المستخدم                          |                                              |
| `role_id`        | `INT`             | معرف الدور (مفتاح خارجي لجدول `Roles`) | مطلوب                                       |
| `created_at`     | `TIMESTAMP`       | تاريخ ووقت إنشاء الحساب                 | الافتراضي: `NOW()`                           |
| `updated_at`     | `TIMESTAMP`       | تاريخ ووقت آخر تحديث للحساب             | الافتراضي: `NOW()`، يتم التحديث تلقائياً |
| `is_active`      | `BOOLEAN`         | حالة تفعيل الحساب                       | الافتراضي: `TRUE`                            |

### ب. جدول `Roles` (الأدوار)
يحدد هذا الجدول الأدوار المختلفة في النظام (التاجر، اللجنة الفنية، اللجنة العليا) والصلاحيات المرتبطة بها.

| الحقل       | نوع البيانات   | الوصف                                | ملاحظات         |
| :---------- | :------------- | :----------------------------------- | :--------------- |
| `role_id`   | `SERIAL`       | معرف فريد للدور (مفتاح أساسي)       | يتم إنشاؤه تلقائياً |
| `role_name` | `VARCHAR(50)`  | اسم الدور (مثال: 'Trader', 'Technical Committee', 'Higher Committee') | مطلوب، فريد     |
| `description` | `TEXT`         | وصف تفصيلي للدور                     |                  |

### ج. جدول `Complaints` (الشكاوى)
يحتوي هذا الجدول على جميع تفاصيل الشكاوى المقدمة من قبل التجار.

| الحقل               | نوع البيانات      | الوصف                                   | ملاحظات                                     |
| :------------------ | :---------------- | :-------------------------------------- | :------------------------------------------- |
| `complaint_id`      | `UUID` / `BIGINT` | معرف فريد للشكوى (مفتاح أساسي)         |                                              |
| `trader_id`         | `UUID` / `BIGINT` | معرف التاجر الذي قدم الشكوى (مفتاح خارجي لجدول `Users`) | مطلوب                                       |
| `title`             | `VARCHAR(255)`    | عنوان الشكوى                           | مطلوب                                       |
| `description`       | `TEXT`            | وصف تفصيلي للشكوى                      | مطلوب                                       |
| `category_id`       | `INT`             | معرف تصنيف الشكوى (مفتاح خارجي لجدول `ComplaintCategories`) | مطلوب                                       |
| `status_id`         | `INT`             | معرف حالة الشكوى (مفتاح خارجي لجدول `ComplaintStatuses`) | مطلوب                                       |
| `priority`          | `VARCHAR(50)`     | أولوية الشكوى (مثال: 'Low', 'Medium', 'High') | الافتراضي: 'Medium'                          |
| `submitted_at`      | `TIMESTAMP`       | تاريخ ووقت تقديم الشكوى                | الافتراضي: `NOW()`                           |
| `last_updated_at`   | `TIMESTAMP`       | تاريخ ووقت آخر تحديث للشكوى            | الافتراضي: `NOW()`، يتم التحديث تلقائياً |
| `assigned_to_committee_id` | `UUID` / `BIGINT` | معرف اللجنة الفنية المسؤولة (مفتاح خارجي لجدول `Users` - أعضاء اللجنة الفنية) | يمكن أن يكون `NULL` في البداية             |
| `resolution_details` | `TEXT`            | تفاصيل الحل أو القرار النهائي           | يمكن أن يكون `NULL`                          |
| `closed_at`         | `TIMESTAMP`       | تاريخ ووقت إغلاق الشكوى                 | يمكن أن يكون `NULL`                          |

### د. جدول `ComplaintCategories` (تصنيفات الشكاوى)
يحتوي هذا الجدول على تصنيفات الشكاوى المحددة (مالية، خدمات، تقنية، أخرى) بناءً على ملف `تكرارالشكاوى.docx`.

| الحقل          | نوع البيانات   | الوصف                                | ملاحظات         |
| :------------- | :------------- | :----------------------------------- | :--------------- |
| `category_id`  | `SERIAL`       | معرف فريد للتصنيف (مفتاح أساسي)     | يتم إنشاؤه تلقائياً |
| `category_name` | `VARCHAR(100)` | اسم التصنيف (مثال: 'مالية', 'خدمات', 'تقنية') | مطلوب، فريد     |
| `description`  | `TEXT`         | وصف التصنيف                         |                  |

### هـ. جدول `ComplaintStatuses` (حالات الشكاوى)
يحتوي هذا الجدول على الحالات المحتملة للشكوى (جديدة، تحت المعالجة، مكتملة، مرفوضة، إلخ).

| الحقل         | نوع البيانات   | الوصف                                | ملاحظات         |
| :------------ | :------------- | :----------------------------------- | :--------------- |
| `status_id`   | `SERIAL`       | معرف فريد للحالة (مفتاح أساسي)      | يتم إنشاؤه تلقائياً |
| `status_name` | `VARCHAR(50)`  | اسم الحالة (مثال: 'جديدة', 'تحت المعالجة', 'مكتملة') | مطلوب، فريد     |
| `description` | `TEXT`         | وصف الحالة                          |                  |

### و. جدول `ComplaintAttachments` (مرفقات الشكاوى)
يخزن هذا الجدول معلومات عن الملفات والصور المرفقة بكل شكوى.

| الحقل            | نوع البيانات      | الوصف                                   | ملاحظات                                     |
| :--------------- | :---------------- | :-------------------------------------- | :------------------------------------------- |
| `attachment_id`  | `UUID` / `BIGINT` | معرف فريد للمرفق (مفتاح أساسي)         |                                              |
| `complaint_id`   | `UUID` / `BIGINT` | معرف الشكوى المرتبطة (مفتاح خارجي لجدول `Complaints`) | مطلوب                                       |
| `file_name`      | `VARCHAR(255)`    | اسم الملف الأصلي                        | مطلوب                                       |
| `file_path`      | `VARCHAR(255)`    | المسار إلى الملف المخزن (في نظام التخزين السحابي أو المحلي) | مطلوب                                       |
| `file_type`      | `VARCHAR(50)`     | نوع الملف (مثال: 'image/jpeg', 'application/pdf') |                                              |
| `uploaded_at`    | `TIMESTAMP`       | تاريخ ووقت رفع الملف                   | الافتراضي: `NOW()`                           |

### ز. جدول `ComplaintComments` (تعليقات الشكاوى)
يحتوي هذا الجدول على سجل التعليقات والتواصل بين المستخدمين واللجان حول الشكاوى.

| الحقل          | نوع البيانات      | الوصف                                   | ملاحظات                                     |
| :------------- | :---------------- | :-------------------------------------- | :------------------------------------------- |\n| `comment_id`   | `UUID` / `BIGINT` | معرف فريد للتعليق (مفتاح أساسي)        |                                              |
| `complaint_id` | `UUID` / `BIGINT` | معرف الشكوى المرتبطة (مفتاح خارجي لجدول `Complaints`) | مطلوب                                       |
| `user_id`      | `UUID` / `BIGINT` | معرف المستخدم الذي أضاف التعليق (مفتاح خارجي لجدول `Users`) | مطلوب                                       |
| `comment_text` | `TEXT`            | نص التعليق                              | مطلوب                                       |
| `created_at`   | `TIMESTAMP`       | تاريخ ووقت إضافة التعليق                | الافتراضي: `NOW()`                           |

### ح. جدول `Notifications` (الإشعارات)
يخزن هذا الجدول الإشعارات التي يتم إرسالها للمستخدمين (التجار واللجان).

| الحقل             | نوع البيانات      | الوصف                                   | ملاحظات                                     |
| :---------------- | :---------------- | :-------------------------------------- | :------------------------------------------- |
| `notification_id` | `UUID` / `BIGINT` | معرف فريد للإشعار (مفتاح أساسي)        |                                              |
| `user_id`         | `UUID` / `BIGINT` | معرف المستخدم المستلم (مفتاح خارجي لجدول `Users`) | مطلوب                                       |
| `complaint_id`    | `UUID` / `BIGINT` | معرف الشكوى المرتبطة (مفتاح خارجي لجدول `Complaints`) | يمكن أن يكون `NULL` لبعض الإشعارات العامة |
| `message`         | `TEXT`            | نص الإشعار                              | مطلوب                                       |
| `type`            | `VARCHAR(50)`     | نوع الإشعار (مثال: 'status_update', 'new_comment', 'assignment') |                                              |
| `is_read`         | `BOOLEAN`         | هل تم قراءة الإشعار؟                    | الافتراضي: `FALSE`                           |
| `created_at`      | `TIMESTAMP`       | تاريخ ووقت إنشاء الإشعار                | الافتراضي: `NOW()`                           |

## 2. العلاقات بين الجداول

*   **`Users` و `Roles`:** علاقة واحد إلى متعدد (One-to-Many). كل مستخدم ينتمي إلى دور واحد، وكل دور يمكن أن يضم عدة مستخدمين. (`Users.role_id` -> `Roles.role_id`)
*   **`Complaints` و `Users` (كمقدم شكوى):** علاقة واحد إلى متعدد (One-to-Many). كل شكوى يقدمها تاجر واحد. (`Complaints.trader_id` -> `Users.user_id`)
*   **`Complaints` و `Users` (كعضو لجنة فنية):** علاقة واحد إلى متعدد (One-to-Many). يمكن تعيين شكوى لعضو لجنة فنية واحد. (`Complaints.assigned_to_committee_id` -> `Users.user_id`)
*   **`Complaints` و `ComplaintCategories`:** علاقة واحد إلى متعدد (One-to-Many). كل شكوى تنتمي إلى تصنيف واحد. (`Complaints.category_id` -> `ComplaintCategories.category_id`)
*   **`Complaints` و `ComplaintStatuses`:** علاقة واحد إلى متعدد (One-to-Many). كل شكوى لها حالة واحدة. (`Complaints.status_id` -> `ComplaintStatuses.status_id`)
*   **`ComplaintAttachments` و `Complaints`:** علاقة واحد إلى متعدد (One-to-Many). كل مرفق يتبع شكوى واحدة، والشكوى يمكن أن تحتوي على عدة مرفقات. (`ComplaintAttachments.complaint_id` -> `Complaints.complaint_id`)
*   **`ComplaintComments` و `Complaints`:** علاقة واحد إلى متعدد (One-to-Many). كل تعليق يتبع شكوى واحدة، والشكوى يمكن أن تحتوي على عدة تعليقات. (`ComplaintComments.complaint_id` -> `Complaints.complaint_id`)
*   **`ComplaintComments` و `Users`:** علاقة واحد إلى متعدد (One-to-Many). كل تعليق يضيفه مستخدم واحد. (`ComplaintComments.user_id` -> `Users.user_id`)
*   **`Notifications` و `Users`:** علاقة واحد إلى متعدد (One-to-Many). كل إشعار يرسل لمستخدم واحد. (`Notifications.user_id` -> `Users.user_id`)
*   **`Notifications` و `Complaints`:** علاقة واحد إلى متعدد (One-to-Many). يمكن أن يرتبط الإشعار بشكوى معينة. (`Notifications.complaint_id` -> `Complaints.complaint_id`)

## 3. الهيكل التقني المقترح (Technical Architecture)

سيتم بناء التطبيق باستخدام هيكل **Microservices** أو **Monolithic** مع فصل واضح بين الواجهة الأمامية والخلفية، وذلك لضمان قابلية التوسع والصيانة.

### أ. الواجهة الأمامية (Frontend)
*   **التقنية:** React.js أو Vue.js.
*   **الوظيفة:** توفير واجهات المستخدم التفاعلية لكل من التاجر، اللجنة الفنية، واللجنة العليا.
*   **الميزات:** دعم اللغتين (العربية والإنجليزية)، تصميم متجاوب، نظام توجيه (Routing) لإدارة الصفحات، إدارة الحالة (State Management) مثل Redux أو Vuex.

### ب. الواجهة الخلفية (Backend)
*   **التقنية:** Node.js مع Express.js أو Python مع Flask/Django.
*   **الوظيفة:** توفير واجهات برمجة التطبيقات (APIs) للواجهة الأمامية، إدارة منطق الأعمال، التفاعل مع قاعدة البيانات، وإدارة المصادقة والتفويض.
*   **الميزات:** RESTful API، معالجة الطلبات، إدارة الأخطاء، تسجيل الدخول (Logging).

### ج. قاعدة البيانات (Database)
*   **التقنية:** PostgreSQL.
*   **الوظيفة:** تخزين جميع بيانات التطبيق بشكل منظم وآمن.
*   **الميزات:** دعم المعاملات (Transactions)، النسخ الاحتياطي والاستعادة، قابلية التوسع.

### د. المصادقة والتفويض (Authentication & Authorization)
*   **التقنية:** JSON Web Tokens (JWT) و/أو OAuth2.
*   **الوظيفة:** التحقق من هوية المستخدمين وتحديد صلاحياتهم للوصول إلى الموارد المختلفة.
*   **الميزات:** تسجيل الدخول الآمن، إدارة الجلسات، حماية المسارات (API Endpoints).

### هـ. التخزين السحابي (Cloud Storage)
*   **الوظيفة:** تخزين الملفات والمرفقات (صور، مستندات) التي يرفعها المستخدمون.
*   **التقنية المقترحة:** Amazon S3 أو Google Cloud Storage أو أي حل تخزين كائني (Object Storage) آخر.
*   **الميزات:** قابلية التوسع، التوافرية العالية، الأمان.

### و. الإشعارات (Notifications)
*   **التقنية:** يمكن استخدام خدمات مثل Firebase Cloud Messaging (FCM) للإشعارات الفورية (Push Notifications) وخدمات البريد الإلكتروني (مثل SendGrid أو AWS SES) لإرسال الإشعارات عبر البريد الإلكتروني.
*   **الوظيفة:** إرسال تحديثات فورية للمستخدمين حول حالة شكواهم أو أي تفاعلات أخرى.

### ز. الاستضافة والنشر (Hosting & Deployment)
*   **التقنية:** Docker و Kubernetes.
*   **الوظيفة:** تغليف التطبيق في حاويات (Containers) ونشره في بيئة قابلة للتوسع وعالية التوافرية.
*   **الميزات:** سهولة النشر، إدارة الموارد، التحجيم التلقائي (Auto-scaling)، التوازن بين الأحمال (Load Balancing).

## 4. تصميم الواجهات (UI/UX) - منظور تقني

*   **مكتبات المكونات (Component Libraries):** استخدام مكتبات مثل Material-UI (لـ React) أو Vuetify (لـ Vue.js) لتسريع عملية التطوير وضمان اتساق التصميم.
*   **دعم RTL/LTR:** تطبيق CSS Frameworks التي تدعم الاتجاهات المختلفة للكتابة (Right-to-Left for Arabic, Left-to-Right for English) مثل Bootstrap RTL أو تخصيص CSS.
*   **التصميم المتجاوب (Responsive Design):** استخدام تقنيات CSS مثل Flexbox و Grid Media Queries لضمان عرض التطبيق بشكل صحيح على جميع الأجهزة (المكتبية، اللوحية، الهواتف الذكية).

هذا التصميم يوفر أساسًا متينًا لتطوير تطبيق الشكاوى الإلكتروني، مع الأخذ في الاعتبار المتطلبات الوظيفية وغير الوظيفية مثل الأداء، الأمان، وقابلية التوسع.
